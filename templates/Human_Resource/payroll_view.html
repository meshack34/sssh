{% extends 'base.html' %}


{% block body_block %}
{% load static %}
<style>
    #atten_table,
    #atten_table td,
    #atten_table tr {
        border: 1px solid !important;
    }
</style>
<section class="content">
    <div class="row">
        <!-- left column -->
        <div class="col-md-12">
            <div class="box box-primary">
                <div class="box-header ">
                    <div class="row ">
                        <div class="col-md-4">
                            <h3 class="box-title">Staff Details</h3>
                        </div>
                        <div class="col-md-8 ">
                            <div class="btn-group pull-right">
                                <a href="{% url 'payroll'%}" type="button" class="btn btn-primary btn-xs">
                                    <i class="fa fa-arrow-left"></i> </a>
                            </div>
                        </div>
                    </div>
                </div><!--./box-header-->
                <div class="box-body card" style="padding:20px;">
                    <div class="row">
                        <div class="col-md-8 col-sm-12 ">
                            <div class="sfborder">
                                <div class="col-md-2">
                                    <div class="row">
                                        <img width="115" height="115" class="round5"
                                            src="https://www.school.infomainia.in/uploads/staff_images/no_image.png"
                                            alt="No Image">
                                    </div>
                                </div>

                                <div class="col-md-10">
                                    <div class="row">
                                        <table class="table mb0 font13">
                                            <tbody>
                                                <tr>
                                                    <th>Name</th>
                                                    <td>{{record.first_name}} </td>
                                                    <th>Staff ID</th>
                                                    <td>{{record.staff_id}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Phone no</th>
                                                    <td>{{record.staff_id}}</td>
                                                    <th>Email</th>
                                                    <td>{{ record.email }}</td>
                                                </tr>
                                                <tr>
                                                    <th>EPF No</th>
                                                    <td>{{ record.epf_no }}</td>
                                                    <th>Role</th>
                                                    <td>{{ record.roles }}</td>
                                                </tr>
                                                <tr>
                                                    <th>Department</th>
                                                    <td>{{ record.department }}</td>
                                                    <th>Designation</th>
                                                    <td>{{ record.designation }}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div><!--./col-md-8-->

                        <div class="col-md-4 col-sm-12 ">
                            <div class="sfborder relative overvisible">
                                <div class="letest">
                                    <div class="rotatetest">Attendance</div>
                                </div>
                                <div class="padd-en-rtl33">
                                    <table class="table mb0 font13" id="atten_table">
                                        <tr>
                                            <th class="bozero">Month</th>
                                            <th class="bozero"><span data-toggle="tooltip" title="Present">P</span></th>
                                            <th class="bozero"><span data-toggle="tooltip" title="Late">L</span></th>
                                            <th class="bozero"><span data-toggle="tooltip" title="Absent">A</span></th>
                                            <th class="bozero"><span data-toggle="tooltip" title="Half Day">F</span>
                                            </th>
                                            <th class="bozero"><span data-toggle="tooltip" title="Holiday">H</span></th>

                                            <th class="bozero"><span data-toggle="tooltip"
                                                    title="Approved Leave">V</span></th>
                                        </tr>
                                        <tr>
                                            <td>March</td>
                                            <td>{{staffs}}</td>
                                            <td>{{staffss}}</td>
                                            <td>{{staffsss}}</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>April</td>
                                            <td>{{present_2}}</td>
                                            <td>{{Late_2}}</td>
                                            <td>{{Absent_2}}</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>May</td>
                                            <td>{{present_3}}</td>
                                            <td>{{Late_3}}</td>
                                            <td>{{Absent_3}}</td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>


                                        </tr>

                                    </table>
                                </div>
                            </div>

                        </div><!--./col-md-8-->
                        <div class="col-md-12">
                            <div
                                style="background: #dadada; height: 1px; width: 100%; clear: both; margin-bottom: 10px;">
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.box-body -->

                <div class="box-header card" style="padding: 20px;">
                    <div class="row display-flex">
                        <div class="col-md-3 col-sm-4 ">
                            <h3 class="box-title">Earning</h3>
                            <button type="button" onclick="add_more()" class="plusign btn btn-primary"
                                style="float: right;"><i class="fa fa-plus"></i></button>
                            <table class="table3" id="tableID">
                                <tbody>
                                    <tr id="row0">
                                        <td colspan="2"><input type="text" class="form-control" id="allowance_type"
                                                name="allowance_type[]" placeholder="Type"></td>
                                        <td><input type="text" id="allowance_amount" name="allowance_amount[]"
                                                class="form-control" value="0"></td>
                                        <td></td>

                                    </tr>
                                </tbody>
                            </table>

                        </div><!--./col-md-4-->
                        <div class="col-md-3 col-sm-4">
                            <h3 class="box-title">Deduction</h3>
                            <button type="button" onclick="add_more_deduction()" class="plusignbtn btn btn-primary"
                                style="float: right;"><i class="fa fa-plus"></i></button><br><br>
                            <table class="table3" id="tableID2">
                                <tbody>
                                    <tr id="deduction_row0">
                                        <td><input type="text" id="deduction_type" name="deduction_type[]"
                                                class="form-control" placeholder="Type"></td>
                                        <td><input type="text" id="deduction_amount" name="deduction_amount[]"
                                                class="form-control" value="0"></td>

                                    </tr>
                                </tbody>
                            </table>
                        </div><!--./col-md-4-->

                        <div class="col-md-6 col-sm-4">
                            <form method="post">
                                {% csrf_token %}
                                <h3 class="box-title">Payroll Summary($)</h3>
                                <div class="row">
                                    <div class="col-md-12">
                                        <button type="button" onclick="add_allowance()" class="plusign btn"
                                            style="float: right;"><i class="fa fa-calculator"></i> Calculate</button>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Basic Salary</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" name="basicsalary" value="{% if record.basic_salary %}{{record.basic_salary}}{% endif %}" id="basic"
                                                type="text" />
                                                <br>
                                               
                                        </div>
                                       
                                    </div><!--./form-group-->
                                  
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Earning</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" name="earning" id="total_allowance"
                                                type="text" />
                                                <br>
                                        </div>
                                    </div><!--./form-group-->
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Deduction</label>
                                        <div class="col-sm-8 deductiondred">
                                            <input class="form-control" name="deduction" id="total_deduction"
                                                type="text" style="color:#f50000" />
                                        </div>
                                    </div><!--./form-group-->

                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Gross Salary</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" name="gross_salary" id="gross_salary" value=""
                                                type="text" />
                                                <br>
                                        </div>
                                    </div><!--./form-group-->
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Tax</label>
                                        <div class="col-sm-8 deductiondred">
                                            <input class="form-control" name="tax" id="tax" value="0" type="text" />
                                            <br>
                                        </div>
                                    </div><!--./form-group-->

                                    <hr />
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">Net Salary</label>
                                        <div class="col-sm-8 net_green">
                                            <input class="form-control greentest" name="net_salary" id="net_salary"
                                                type="text" />
                                                <br>
                                            <span class="text-danger" id="err"></span>
                                        </div>
                                    </div><!--./form-group-->
                                </div>

                                <br>
                                <button type="submit" class="btn btn-info pull-right">Save</button>
                                <br>
                            </form>
                        </div><!--./row-->
                    </div><!--./box-header-->
                </div>
            </div>
            <!--/.col (left) -->
        </div>
</section>
</div>
{% endblock %}
{% block script_block %}
<script>
    function add_allowance() {

        var basic_pay = $("#basic").val();
        var allowance_type = document.getElementsByName('allowance_type[]');
        var allowance_amount = document.getElementsByName('allowance_amount[]');
        //var leave_deduction = $("#leave_deduction").val();
        var tax = $("#tax").val();
        if (tax == '') {
            var tax = 0;
        }

        var total_allowance = 0;

        var deduction_type = document.getElementsByName('deduction_type[]');
        var deduction_amount = document.getElementsByName('deduction_amount[]');

        var total_deduction = 0;

        for (var i = 0; i < allowance_amount.length; i++) {

            var inp = allowance_amount[i];

            if (inp.value == '') {

                var inpvalue = 0;
            } else {
                var inpvalue = inp.value;
            }

            total_allowance += parseFloat(inpvalue);

        }

        for (var j = 0; j < deduction_amount.length; j++) {


            var inpd = deduction_amount[j];

            if (inpd.value == '') {

                var inpdvalue = 0;

            } else {

                var inpdvalue = inpd.value;
            }
            total_deduction += parseFloat(inpdvalue);
        }


        //total_deduction += parseInt(leave_deduction) ;

        var gross_salary = parseFloat(basic_pay) + parseFloat(total_allowance) - parseFloat(total_deduction);

        var net_salary = parseFloat(basic_pay) + parseFloat(total_allowance) - parseFloat(total_deduction) - parseFloat(tax);

        $("#total_allowance").val(total_allowance.toFixed(2));
        $("#total_deduction").val(total_deduction.toFixed(2));
        $("#total_allow").html(total_allowance.toFixed(2));
        $("#total_deduc").html(total_deduction.toFixed(2));
        $("#gross_salary").val(gross_salary.toFixed(2));
        $("#net_salary").val(net_salary.toFixed(2));

    }

</script>
<script>
    function add_more() {

        var table = document.getElementById("tableID");
        var table_len = (table.rows.length);
        var id = parseInt(table_len);
        var row = table.insertRow(table_len).outerHTML = "<tr id='row" + id + "'><td colspan='2'><input type='text' class='form-control' id='allowance_type'  name='allowance_type[]' placeholder='Type'></td><td><input type='text' class='form-control' id='allowance_amount' name='allowance_amount[]'  value='0'></td><td><button type='button' onclick='delete_row(" + id + ")' class='closebtn btn btn-danger'><i class='fa fa-remove'></i></button></td></tr>";
    }

    function delete_row(id) {


        var table = document.getElementById("tableID");
        var rowCount = table.rows.length;
        $("#row" + id).html("");
        //table.deleteRow(id);
    }


    function add_more_deduction() {

        var table = document.getElementById("tableID2");
        var table_len = (table.rows.length);
        var id = parseInt(table_len);
        var row = table.insertRow(table_len).outerHTML = "<tr id='deduction_row" + id + "'><td><input type='text' class='form-control' id='deduction_type' name='deduction_type[]' placeholder='Type'></td><td><input type='text' id='deduction_amount' name='deduction_amount[]' class='form-control' value='0'></td><td><button type='button' onclick='delete_deduction_row(" + id + ")' class='closebtn btn btn-danger'><i class='fa fa-remove'></i></button></td></tr>";

    }

    function delete_deduction_row(id) {


        var table = document.getElementById("tableID2");
        var rowCount = table.rows.length;
        $("#deduction_row" + id).html("");
        //table.deleteRow(id);
    }

</script>

{% endblock %}